---
title: Metamerismo estadístico
author: Elio
date: '2018-12-18'
draft: yes
slug: metamerismo-estadístico
categories:
  - R
  - estadística
tags:
  - paquetes
bibliography: metameros.bib
link-citations: true
---



<p>En este post muestro el paquete <a href="https://github.com/eliocamp/metamer">metamer</a>, que implementa en R el algoritmo descripto por <span class="citation">Matejka and Fitzmaurice (<a href="#ref-Matejka2017">2017</a>)</span> para generar sets de datos distintos entre sí pero con estadísticos idénticos. Además, propongo el nombre “metámeros” para estos grupos de datos en analogía con el concepto proveniente de colorimetría.</p>
<!--more-->
<div id="metameros-en-la-vision" class="section level2">
<h2>Metámeros en la visión</h2>
<p>Miren esta foto de un prisma separando luz blanca en las infinitas longitudes de onda que la componen.</p>
<p><img src="/images/Prism_flat_rainbow.jpg" /></p>
<p>Pero si el monitor que estás usando para ver la imgen sólo emite luz en 3 longitudes de onda (roja, verde y azul), ¿cómo hace para reproducir todo el espectro? La respuesta es que no lo hace. Para cada color de ese arcoíris, tu monitor está emitiendo una mezcla de longitudes de onda que nuestro sistema visual interpreta como el mismo color que esa longitud de onda específica.</p>
<p>Cómo sucede todo eso es complicadísimo y va más allá de lo que pueda explicar en este artículo (pero sí recomiendo leer <a href="http://jamie-wong.com/post/color/">esta excelente nota</a> sobre el tema) pero el núcleo de la cuestión es que nuestros ojos tienen sólo tres tipos de receptores (conos) que responden a longitudes de onda cortas (S), medias (M) y largas (L). Por lo tanto, cualquier distribución de longitudes de onda que vemos, sin importar cuán complicadas sean, se reducen a únicamente tres números: la excitación de los receptores S, M y L. Esto significa que cualquier distribución de longitudes de onda que excite nuestros receptores en la misma proporción va a ser percibido como el mismo color. En colorimetría, esto se conoce como <em>metamerismo</em> y es la base de la reproducción del color de monitores, impresiones y cuadros <span class="citation">(Hunt <a href="#ref-Hunt2004-7">2004</a>)</span>. El amarillo monocromático que se ve en un prisma se ve igual que el amarillo producido por el monitor aunque no tenga ni remotamente el mismo espectro. Son metámeros.</p>
</div>
<div id="metameros-en-la-estadistica" class="section level2">
<h2>Metámeros en la estadística</h2>
<p>Ahora pensemos en el famoso cuarteto de Anscombe</p>
<div class="figure"><span id="fig:anscombe-plot"></span>
<img src="/post/2018-12-18-metamerismo-estad%C3%ADstico_files/figure-html/anscombe-plot-1.png" alt="Cuarteto de Anscombe" width="672" />
<p class="caption">
Fig. 1: Cuarteto de Anscombe
</p>
</div>
<p>A pesar de ser cuatro sets de datos muy distintos, los miembros del cuarteto comparten el promedio y desvío estándar de cada variable, así como la correlación entre ambas <span class="citation">(Anscombe <a href="#ref-Anscombe1973">1973</a>)</span>. Al igual que nuestros ojos, reducir la complejidad de un set de datos en sólo algunos pocos números quita información. Los mismos números pueden obtenerse a partir de distintos datos. El concepto de “datos con estadísticos idénticos pero gráficos distintos” todavía tiene relevancia, con varias publicaciones describiendo distintos métodos para crearlos <span class="citation">(p.e. Chatterjee and Firat <a href="#ref-Chatterjee2007">2007</a>; Govindaraju and Haslett <a href="#ref-Govindaraju2008">2008</a>; Haslett and Govindaraju <a href="#ref-Haslett2009">2009</a>; Matejka and Fitzmaurice <a href="#ref-Matejka2017">2017</a>)</span> pero, que yo sepa, nunca fue nombrado. En analogía al metamerismo del color, propongo llamar “metámeros” a cualquier conjunto de sets de datos que se comporta de forma idéntica bajo una determinada transformación estadística.</p>
<p>En virtud de esta denominación, el paquete {<a href="https://github.com/eliocamp/metamer">metamer</a>} implementa el algoritmo de <span class="citation">Matejka and Fitzmaurice (<a href="#ref-Matejka2017">2017</a>)</span> para generar metámeros. La función principal, <code>metamerize()</code>, permite generar metámeros a partir de un data set inicial y una función a preservar. Opcionalmente, se puede establecer una función que deben minimizar los metámeros sucesivos.</p>
<p>Primero, con la función <code>delayed_with()</code> definimos la serie de transformaciones estadísticas que deben ser preservadas. Como vemos, los cuatro elementos del cuarteto de anscombe preservan estas propiedades con hasta tres cifras significativas (salvo por la correlación entre x e y en el cuarto cuarteto).</p>
<pre class="r"><code>library(metamer)

summ_fun &lt;- delayed_with(mean_x = mean(x), 
                         mean_y = mean(y), 
                         sd_x = sd(x), 
                         sd_y = sd(y), 
                         cor_xy = cor(x, y))
summ_names &lt;-  c(&quot;$\\overline{x}$&quot;, &quot;$\\overline{y}$&quot;, 
                 &quot;$S_x$&quot;,  &quot;$S_y$&quot;, &quot;$r(x, y)$&quot;)

anscombe[, as.list(signif(summ_fun(.SD), 3)), by = quartet] %&gt;% 
   knitr::kable(col.names = c(&quot;Cuarteto&quot;, summ_names),
                escape = FALSE, 
                caption = &quot;Propiedades estadísticas del cuarteto de Anscombe&quot;)</code></pre>
<table>
<caption><span id="tab:anscombe-summ">Tab. 1: </span>Propiedades estadísticas del cuarteto de Anscombe</caption>
<thead>
<tr class="header">
<th align="left">Cuarteto</th>
<th align="right"><span class="math inline">\(\overline{x}\)</span></th>
<th align="right"><span class="math inline">\(\overline{y}\)</span></th>
<th align="right"><span class="math inline">\(S_x\)</span></th>
<th align="right"><span class="math inline">\(S_y\)</span></th>
<th align="right"><span class="math inline">\(r(x, y)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="left">4</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.817</td>
</tr>
</tbody>
</table>
<p>Ahora, definimos el data set inicial y al que queremos llegar, utilizando <code>mean_dist_to()</code> para definir la distancia que queremos minimizar.</p>
<pre class="r"><code>start_data &lt;- subset(anscombe, quartet == 2)
start_data$quartet &lt;- NULL

target &lt;- subset(anscombe, quartet == 3)
target$quartet &lt;- NULL

set.seed(42)  # para resultados reproducibles
metamers &lt;- metamerize(start_data, 
                       preserve = summ_fun,
                       minimize = mean_dist_to(target), 
                       signif = 3,
                       change = &quot;y&quot;,
                       perturbation = 0.008, 
                       N = 40000)
print(metamers)</code></pre>
<pre><code>## List of 5622 metamers</code></pre>
<p>El proceso genera 5622 metámeros. Con <code>trim()</code> seleccionamos 10 metámeros equiespaciados en todo el proceso para ver que, efectivamente, todos preservaron las propiedades que queríamos preservar.</p>
<pre class="r"><code>metamers %&gt;% 
   trim(10) %&gt;% 
   as.data.frame() %&gt;% 
   as.data.table() %&gt;% 
   .[, as.list(signif(summ_fun(.SD), 3)), by = .metamer] %&gt;% 
   knitr::kable(col.names = c(&quot;Metámero&quot;, summ_names),
                caption = &quot;Propiedades estadísticas de los metámeros generados.&quot;)</code></pre>
<table>
<caption><span id="tab:anscombe-metamers">Tab. 2: </span>Propiedades estadísticas de los metámeros generados.</caption>
<thead>
<tr class="header">
<th align="right">Metámero</th>
<th align="right"><span class="math inline">\(\overline{x}\)</span></th>
<th align="right"><span class="math inline">\(\overline{y}\)</span></th>
<th align="right"><span class="math inline">\(S_x\)</span></th>
<th align="right"><span class="math inline">\(S_y\)</span></th>
<th align="right"><span class="math inline">\(r(x, y)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">9</td>
<td align="right">7.5</td>
<td align="right">3.32</td>
<td align="right">2.03</td>
<td align="right">0.816</td>
</tr>
</tbody>
</table>
<p>Y usando {<a href="https://github.com/thomasp85/gganimate">gganimate</a>} podemos visualizar cómo pasar del segundo al tercer cuarteto. Todos los pasos intermedios son metámeros del original.</p>
<pre class="r"><code>metamers %&gt;% 
   trim(100) %&gt;% 
   as.data.frame() %&gt;% 
   ggplot(aes(x, y)) +
   geom_point() +
   transition_manual(.metamer)</code></pre>
<div class="figure"><span id="fig:anscombe-animate"></span>
<img src="/post/2018-12-18-metamerismo-estad%C3%ADstico_files/figure-html/anscombe-animate-1.gif" alt="Transformación del segundo al tercer cuarteto de Anscombe."  />
<p class="caption">
Fig. 2: Transformación del segundo al tercer cuarteto de Anscombe.
</p>
</div>
<p>En general la discusión alrededor del metamerismo estadístico suele ser sobre la importancia de graficar los datos en vez de únicamente calcular estadísticas resumidas. Anscombe creó su cuarteto para contradecir la idea de que “los cálculos numéricos son exactos, mientras que los gráficos son aproximados” y también este es el <em>framing</em> que se le da actualmente:</p>
<p><a href="https://twitter.com/albertocairo/status/770267777169035264"><img src="/images/datasaurus_tweet.png" /></a></p>
<p>Sin embargo, creo que hay un principio más fundamental. El problema de las <em>summary statistics</em> es la parte de <em>summary</em>. El rol de la estadística es, en muchos casos, <em>resumir</em> datos. Es tomar una gran cantidad de observaciones que no pueden ser entendidas en su completitud por nuestro limitado entendimiento y reducirlas a unos pocos números o propiedades que podemos entender fácilmente. El problema es que, si bien en ese proceso se gana entendimiento, se pierde información.</p>
<p>Veamos el ejemplo de la distribución del ingreso en un país. Un censo de los ingresos de todos los ciudadanos tendría una enorme cantidad de información, pero tomados como datos separados nos dicen poco. Podemos empezar a reducirlo con el promedio (el primer momento) para tener alguna idea del valor “típico” de esta variable. Obviamente, este número puede esconder una gran desigualdad, por lo que podemos usar el desvío estándar (segundo momento) para tener una idea de cuán variable es la distribución del ingreso. Pero es muy probable que la distribución no sea simétrica, y podemos usar la asimetría (tercer momento) para empezar a cuantificar ese efecto.</p>
<p>Por cada momento que agregemos vamos a tener más información sobre los datos crudos. El límite es cuando agregamos tantos momentos como datos en nuestra muestra. Una muestra de tamaño N puede ser unívocamente descripta (a menos del órden de los valores) por sus N primeros momentos. Esto tiene sentito intuitivamente –no se debería necesitar más de N números para describir N números– pero también <a href="https://math.stackexchange.com/questions/3033407/is-a-sample-of-size-n-uniquely-described-by-n-sample-moments">tiene demostración</a> matemática.</p>
<p>En otras palabras, la transformación “primeros N momentos de una muestra de tamaño N” no tiene metámeros estadísticos, a excpeción de la misma muestra en otro orden.</p>
<p>Una demostración empírica es intentarlo:</p>
<pre class="r"><code>start_data &lt;- data.frame(x = rnorm(10))

metamers &lt;- metamerize(start_data, 
                       moments_n(1:10),
                       signif = 3,
                       perturbation = 0.01,
                       N = 30000)
print(metamers)</code></pre>
<pre><code>## List of 1 metamers</code></pre>
<p>No se encontró ningún metámero más allá de los datos originales. En cambio, si buscamos metámeros que preserven menos momentos…</p>
<pre class="r"><code>metamers &lt;- metamerize(start_data, 
                       moments_n(1:2), 
                       signif = 3,
                       perturbation = 0.01,
                       N = 30000)
print(metamers)</code></pre>
<pre><code>## List of 18 metamers</code></pre>
<p>Se encuentran metámeros con relativa facilidad.</p>
<p>Esta propiedad no es única de los momentos estadísticos. La transformada de fourier tiene la misma propiedad, lo mismo que las componentes principales, análisis factorial, clustering. El problema no es gráficos vs. números sino “todos los números” vs. “sólo algunos números”. La ventaja de los gráficos es que permiten representar gran cantidad de números de una forma eficiente e intuitiva, permitiendo una <em>gestalt</em> que es imposible lograr simplemente mirando una serie de números.</p>
</div>
<div id="metameros-avanzados" class="section level2">
<h2>Metámeros avanzados</h2>
<p>El paquete metamer permite dibujar datos mediante la función de ayuda <code>draw_data()</code> que abre una interfaz en shiny.</p>
<pre class="r"><code>start_data &lt;- subset(datasauRus::datasaurus_dozen, dataset == &quot;dino&quot;)
start_data$dataset &lt;- NULL

X &lt;- subset(datasauRus::datasaurus_dozen, dataset == &quot;x_shape&quot;)
X$dataset &lt;- NULL

star &lt;- subset(datasauRus::datasaurus_dozen, dataset == &quot;star&quot;)
star$dataset &lt;- NULL

smiley &lt;- draw_data(start_data)</code></pre>
<div class="figure">
<img src="/images/draw_data.png" alt="Interfaz de draw_data()" />
<p class="caption">Interfaz de <code>draw_data()</code></p>
</div>
<p><code>metamerize()</code> puede encadenarse y guarda los parámetros que se usaron antes salvo <code>N</code> y <code>trim</code>. De esta forma se puede hacer secuencias.</p>
<pre class="r"><code>metamers &lt;- metamerize(start_data, 
                       preserve = delayed_with(mean(x), mean(y), cor(x, y)),
                       minimize = mean_dist_to(smiley), 
                       perturbation = 0.08,
                       N = 30000,
                       trim = 150) %&gt;% 
   metamerize(minimize = NULL, 
              N = 1000, trim = 10) %&gt;% 
   metamerize(minimize = mean_dist_to(X), 
              N = 30000, trim = 150) %&gt;% 
   metamerize(minimize = NULL, 
              N = 1000, trim = 10) %&gt;% 
   metamerize(minimize = mean_dist_to(star), 
              N = 30000, trim = 150) %&gt;%
   metamerize(minimize = NULL, 
              N = 1000, trim = 10) %&gt;% 
   metamerize(minimize = mean_dist_to(start_data),
              N = 30000, trim = 150)</code></pre>
<p>Y ver al datasaurio metamorfoseando en distintas figuras, siempre manteniendo las mismas propiedades estadísticas.</p>
<pre class="r"><code>metamers %&gt;% 
   # trim(600) %&gt;% 
   as.data.frame() %&gt;% 
   ggplot(aes(x, y)) +
   geom_point() +
   transition_manual(.metamer)</code></pre>
<p><img src="/post/2018-12-18-metamerismo-estad%C3%ADstico_files/figure-html/metamer-chain-anim-1.gif" /><!-- --></p>
</div>
<div id="referencias" class="section level2 unnumbered">
<h2>Referencias</h2>
<div id="refs" class="references">
<div id="ref-Anscombe1973">
<p>Anscombe, F J. 1973. “Graphs in Statistical Analysis.” <em>The American Statistician</em> 27 (1): 17–21. <a href="https://doi.org/10.1007/978-3-540-71915-1_35" class="uri">https://doi.org/10.1007/978-3-540-71915-1_35</a>.</p>
</div>
<div id="ref-Chatterjee2007">
<p>Chatterjee, Sangit, and Aykut Firat. 2007. “Generating data with identical statistics but dissimilar graphics: A follow up to the anscombe dataset.” <em>American Statistician</em> 61 (3): 248–54. <a href="https://doi.org/10.1198/000313007X220057" class="uri">https://doi.org/10.1198/000313007X220057</a>.</p>
</div>
<div id="ref-Govindaraju2008">
<p>Govindaraju, K., and S. J. Haslett. 2008. “Illustration of regression towards the means.” <em>International Journal of Mathematical Education in Science and Technology</em> 39 (4): 544–50. <a href="https://doi.org/10.1080/00207390701753788" class="uri">https://doi.org/10.1080/00207390701753788</a>.</p>
</div>
<div id="ref-Haslett2009">
<p>Haslett, S. J., and K. Govindaraju. 2009. “Cloning data: Generating datasets with exactly the same multiple linear regression fit.” <em>Australian and New Zealand Journal of Statistics</em> 51 (4): 499–503. <a href="https://doi.org/10.1111/j.1467-842X.2009.00560.x" class="uri">https://doi.org/10.1111/j.1467-842X.2009.00560.x</a>.</p>
</div>
<div id="ref-Hunt2004-7">
<p>Hunt, R. W. G. 2004. “The Colour Triangle.” In <em>The Reproduction of Colour</em>, 6th ed., 68–91. <a href="https://doi.org/10.1002/0470024275" class="uri">https://doi.org/10.1002/0470024275</a>.</p>
</div>
<div id="ref-Matejka2017">
<p>Matejka, Justin, and George Fitzmaurice. 2017. “Same Stats, Different Graphs.” <em>Proceedings of the 2017 CHI Conference on Human Factors in Computing Systems - CHI ’17</em>, 1290–4. <a href="https://doi.org/10.1145/3025453.3025912" class="uri">https://doi.org/10.1145/3025453.3025912</a>.</p>
</div>
</div>
</div>
