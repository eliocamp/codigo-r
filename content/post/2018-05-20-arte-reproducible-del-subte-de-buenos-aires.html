---
title: Arte reproducible del Subte de Buenos Aires
author: Elio Campitelli
date: '2018-05-20'
slug: arte-reproducible-del-subte-de-buenos-aires
categories:
  - R
tags:
  - ggplot2
---



<p>El sábado pasado estábamos en el subte con mi novia y pasamos por la estación Ángel Gallardo de la Línea B y notamos <a href="http://www.buenosaires.gob.ar/noticias/arte-urbano-en-la-estacion-angel-gallardo">las ilustraciones</a> que tenía ilustraciones en las paredes hechas a partir de líneas de distinto grosor.</p>
<div class="figure">
<img src="/images/subte.jpg" />

</div>
<p>Charlamos un poco sobre ese estilo y cómo se podía replicar con <code>ggplot2</code> usando el paquete <a href="https://github.com/clauswilke/ggridges"><code>ggridges</code></a>.</p>
<p>Lo primero que hago es leer la imagen. Este paso depende del formato (a menos que haya alguna forma de seleccionar el formato correcto automáticamente, pero no conozco). La función <code>readJPEG</code> del paquete <code>jpeg</code> convierte una imagen en un array:</p>
<pre class="r"><code>im &lt;- jpeg::readJPEG(&quot;../../static/images/example.jpg&quot;)
str(im)</code></pre>
<pre><code>##  num [1:400, 1:400, 1:3] 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>La imagen es de 400x400 y tiene 3 canales (rojo, verde y azul). Lo que voy a hacer es pasarla a escala de grises y luego transformar los datos en un data.frame para poder graficarlo con <code>ggplot2</code>. El “algoritmo” que uso acá para pasar de color a grises es simplemente sumar la intensidad de cada color y luego dividir por 3. No sé si es la manera más correcta, pero funciona. Notar que al nombrar las dimensiones del array, revierto el orden de las coordenadas y con <code>rev</code>.</p>
<pre class="r"><code>im &lt;- apply(im, c(1, 2), sum)   # para cada valor de las primeras 2 dimensiones, suma
im &lt;- im/3

ys &lt;- nrow(im)
xs &lt;- ncol(im)
dimnames(im) &lt;- list(y = rev(seq_len(nrow(im))), x = seq_len(ncol(im)))
im &lt;- reshape2::melt(im)
str(im)</code></pre>
<pre><code>## &#39;data.frame&#39;:    160000 obs. of  3 variables:
##  $ y    : int  400 399 398 397 396 395 394 393 392 391 ...
##  $ x    : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ value: num  1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>Ahora que tengo un lindo data.frame, puedo graficarlo. La idea es, para cada línea horizontal (es decir, cada valor de y), graficar un área blanca cuya altura sea proporcional al valor de gris. Además, sólo voy a graficar cada 10 líneas para bajar un poco la resolución y se note más el efecto.</p>
<pre class="r"><code>library(ggplot2)
library(ggridges)
plotim &lt;- subset(im, y  %in% seq(1, ys, by = 10))
ggplot(plotim, aes(x, y)) +
   geom_ridgeline(aes(height = value*9, group = y), 
                  fill = &quot;white&quot;, color = NA) +
   theme(panel.background = element_rect(fill = &quot;black&quot;))</code></pre>
<p><img src="/post/2018-05-20-arte-reproducible-del-subte-de-buenos-aires_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Le falta pulir algunas cosas, pero va bien!</p>
<p>La imagen del subte que quiero reproducir en realidad no usa líneas rectas sino sinusoidales. No estoy seguro si eso se puede reproducir con <code>geom_ridgeline()</code> pero a esta altura decidí meterme con un geom de más bajo nivel. Usando <code>geom_ribbon()</code> puedo poner directamente cuál es el máximo y el mínimo del área, entonces puedo meter un coseno con la amplitud, período y fase que quiera. Además, como esto es Arte<sup>(TM)</sup>, conviene sacar las leyendas y los ejes.</p>
<pre class="r"><code>scale &lt;- 10
per  &lt;- 6
phase &lt;- 0.001
ampl &lt;- scale/5
forecolor &lt;- &quot;white&quot;
backcolor &lt;- &quot;#110C0E&quot;

ggplot(subset(im, y %in% seq(1, ys, by = scale - 1)), aes(x)) +
   geom_ribbon(aes(ymin = y + ampl*cos(x/max(x)*2*pi*per - phase*y) - value*scale/2, 
                   ymax = y + ampl*cos(x/max(x)*2*pi*per - phase*y) + value*scale/2,
                   group = y), fill = forecolor) +
   scale_x_continuous(expand = c(0, 0)) +
   scale_y_continuous(expand = c(0, 0)) +
   coord_equal() +
   theme_void() +
   theme(plot.background = element_rect(fill = backcolor))</code></pre>
<p><img src="/post/2018-05-20-arte-reproducible-del-subte-de-buenos-aires_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Sólo para que sea más divertido, acá abajo está el código completo, armado en una función y que además permite hacer un efecto medio warholiano si se usan los 3 colores en vez de una escala de grises.</p>
<pre class="r"><code>Ridgefy &lt;- function(file, scale = 10, ampl = 1/5, per = 6, phase = 0,
                    forecolor = &quot;white&quot;, backcolor = &quot;black&quot;, ncol = 3) {
   im &lt;- jpeg::readJPEG(file)
   ys &lt;- nrow(im)
   xs &lt;- ncol(im)
   if (length(forecolor) == 3) {
      dimnames(im) &lt;- list(y = rev(seq_len(ys)),
                           x = seq_len(xs),
                           forecolor = forecolor)
      im &lt;- reshape2::melt(im)
   } else {
      im &lt;- apply(im, c(1, 2), sum)
      im &lt;- im/max(im)
      
      dimnames(im) &lt;- list(y = rev(seq_len(ys)), 
                           x = seq_len(xs))
      im &lt;- reshape2::melt(im)
      im$forecolor = forecolor
   }

   ampl &lt;- scale*ampl
   
   ggplot(subset(im, y %in% seq(1, ys, by = scale - 1)), aes(x)) +
      geom_ribbon(aes(ymin = y + ampl*cos(x/max(x)*2*pi*per - phase*y) - value*scale/2, 
                      ymax = y + ampl*cos(x/max(x)*2*pi*per - phase*y) + value*scale/2,
                      group = y,
                      fill = forecolor)) +
      scale_fill_manual(values = forecolor, guide = FALSE) +
      scale_x_continuous(expand = c(0, 0)) +
      scale_y_continuous(expand = c(0, 0)) +
      coord_equal() +
      theme_void() +
      facet_wrap(~forecolor, ncol = ncol) +
      theme(plot.background = element_rect(fill = backcolor), 
            panel.spacing = unit(0, &quot;lines&quot;),
            strip.text = element_blank(),
            strip.background = element_blank())
}</code></pre>
<p>Para terminar, por qué no hacer una imagen bien meta y usar este estilo para transformar la imagen original que me dio la idea.</p>
<pre class="r"><code>Ridgefy(&quot;../../static/images/subte.jpg&quot;, scale = 4, ampl = 0.1,
        forecolor = &quot;#EE0000&quot;, 
        backcolor = &quot;#6E1414&quot;)</code></pre>
<p><img src="/post/2018-05-20-arte-reproducible-del-subte-de-buenos-aires_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
